;;; -*- lexical-binding: t; -*-

(cl-defun replace-selection
    (txt &optional
         (begin (get-selected-region-start))
         (end (get-selected-region-end)))
  (delete-region begin end)
  (insert txt))

(defun hax/nim-wrap-warnings ()
  (interactive)
  (replace-selection (format "(assert fase; {.warning: \"[FIXME] '%s'\".})"
                             (get-selected-region-text))))




(defun hax/insert-radio-link ()
  (interactive)
  (let ((targets
         (matches-in-buffer
          (rx "<<" (group (* (not ">"))) ">>" (group (* word)))
          (lambda () (cons (match-string 1) (match-string 2))))))
    (ivy-read
     "Select target"
     targets
     :action (lambda (x) (message "Selected tag {%s}" x)))))

(cl-defun hax/hex-to-binary (hex &optional
                                 (word-format "%s")
                                 (word-bits 8))
  (s-join
   " "
   (--map
    (format
     word-format
     (s-join " " (--map
                  (s-pad-left word-bits "0" it)
                  (seq-partition (binary-number-to-string (string-to-number it 16)) word-bits))))
    (s-split  " " hex))))

(defun hax/copy-hex-as-binary ()
  (interactive)
  (let* ((sel (hax/hex-to-binary (get-selected-region-text) "[%s]")))
    (with-temp-buffer
      (insert sel)
      (copy-region-as-kill (point-min) (point-max))
      (message "%s" (buffer-substring (point-min) (point-max)))))
  (deactivate-mark))

(defun org-babel-execute:hex (body params)
  (hax/hex-to-binary body "[%s]"))

(custom-set-variables
 '(mini-frame-show-parameters
   '((top . 200)
     (width . 0.8)
     (height . 0.7)
     (left . 0.5))))

(add-to-list 'auto-mode-alist '("\\.ASM" . asm-mode))


(defun hax/asm-mode-hook ()
  (interactive)
  (setq
   imenu-generic-expression
   `(("label" ,(rx bol (group (+ (| (any word) "_"))) ":") 1))))

(add-hook! asm-mode 'hax/asm-mode-hook)

(defun hax/is-temporary-buffer-p ()
  (s-starts-with-p "*" (buffer-name)))

(map!
 [s-right] #'evil-window-increase-width
 [s-left] #'evil-window-decrease-width
 :desc "increase window height"
 [s-up] (cmd! (if (hax/is-temporary-buffer-p)
                  (evil-window-increase-height 20)
                (evil-window-increase-height 1)))
 :desc "decrease window height"
 [s-down] (cmd! (if (hax/is-temporary-buffer-p)
                    (evil-window-decrease-height 20)
                  (evil-window-decrease-height 1))))


;; (defun restyle-ascii-str (str)
;;   (let* ((result))
;;     (dolist )
;;     result
;;     )
;;   )

(setq
 hax/restyle-ascii-table  ;;
 '( ;;
   ?A ("A" "â±¯" "ğ”„" "ğ•¬" "ğ”¸" "ğ€" "ğ´" "ğ‘¨" "ğ’œ" "ğ“" "ğ– " "ğ—”" "ğ˜ˆ" "ğ˜¼" "ğ™°")
   ?B ("B" "B" "ğ”…" "ğ•­" "ğ”¹" "ğ" "ğµ" "ğ‘©" "â„¬" "ğ“‘" "ğ–¡" "ğ—•" "ğ˜‰" "ğ˜½" "ğ™±")
   ?C ("C" "Æ†" "â„­" "ğ•®" "â„‚" "ğ‚" "ğ¶" "ğ‘ª" "ğ’" "ğ“’" "ğ–¢" "ğ—–" "ğ˜Š" "ğ˜¾" "ğ™²")
   ?D ("D" "D" "ğ”‡" "ğ•¯" "ğ”»" "ğƒ" "ğ·" "ğ‘«" "ğ’Ÿ" "ğ““" "ğ–£" "ğ——" "ğ˜‹" "ğ˜¿" "ğ™³")
   ?E ("E" "Æ" "ğ”ˆ" "ğ•°" "ğ”¼" "ğ„" "ğ¸" "ğ‘¬" "â„°" "ğ“”" "ğ–¤" "ğ—˜" "ğ˜Œ" "ğ™€" "ğ™´")
   ?F ("F" "â„²" "ğ”‰" "ğ•±" "ğ”½" "ğ…" "ğ¹" "ğ‘­" "â„±" "ğ“•" "ğ–¥" "ğ—™" "ğ˜" "ğ™" "ğ™µ")
   ?G ("G" "â…" "ğ”Š" "ğ•²" "ğ”¾" "ğ†" "ğº" "ğ‘®" "ğ’¢" "ğ“–" "ğ–¦" "ğ—š" "ğ˜" "ğ™‚" "ğ™¶")
   ?H ("H" "H" "â„Œ" "ğ•³" "â„" "ğ‡" "ğ»" "ğ‘¯" "â„‹" "ğ“—" "ğ–§" "ğ—›" "ğ˜" "ğ™ƒ" "ğ™·")
   ?I ("I" "I" "â„‘" "ğ•´" "ğ•€" "ğˆ" "ğ¼" "ğ‘°" "â„" "ğ“˜" "ğ–¨" "ğ—œ" "ğ˜" "ğ™„" "ğ™¸")
   ?J ("J" "Å¿" "ğ”" "ğ•µ" "ğ•" "ğ‰" "ğ½" "ğ‘±" "ğ’¥" "ğ“™" "ğ–©" "ğ—" "ğ˜‘" "ğ™…" "ğ™¹")
   ?K ("K" "ê°" "ğ”" "ğ•¶" "ğ•‚" "ğŠ" "ğ¾" "ğ‘²" "ğ’¦" "ğ“š" "ğ–ª" "ğ—" "ğ˜’" "ğ™†" "ğ™º")
   ?L ("L" "ê€" "ğ”" "ğ•·" "ğ•ƒ" "ğ‹" "ğ¿" "ğ‘³" "â„’" "ğ“›" "ğ–«" "ğ—Ÿ" "ğ˜“" "ğ™‡" "ğ™»")
   ?M ("M" "Æœ" "ğ”" "ğ•¸" "ğ•„" "ğŒ" "ğ‘€" "ğ‘´" "â„³" "ğ“œ" "ğ–¬" "ğ— " "ğ˜”" "ğ™ˆ" "ğ™¼")
   ?N ("N" "N" "ğ”‘" "ğ•¹" "â„•" "ğ" "ğ‘" "ğ‘µ" "ğ’©" "ğ“" "ğ–­" "ğ—¡" "ğ˜•" "ğ™‰" "ğ™½")
   ?O ("O" "O" "ğ”’" "ğ•º" "ğ•†" "ğ" "ğ‘‚" "ğ‘¶" "ğ’ª" "ğ“" "ğ–®" "ğ—¢" "ğ˜–" "ğ™Š" "ğ™¾")
   ?P ("P" "Ô€" "ğ”“" "ğ•»" "â„™" "ğ" "ğ‘ƒ" "ğ‘·" "ğ’«" "ğ“Ÿ" "ğ–¯" "ğ—£" "ğ˜—" "ğ™‹" "ğ™¿")
   ?Q ("Q" "Ã’" "ğ””" "ğ•¼" "â„š" "ğ" "ğ‘„" "ğ‘¸" "ğ’¬" "ğ“ " "ğ–°" "ğ—¤" "ğ˜˜" "ğ™Œ" "ğš€")
   ?R ("R" "á´š" "â„œ" "ğ•½" "â„" "ğ‘" "ğ‘…" "ğ‘¹" "â„›" "ğ“¡" "ğ–±" "ğ—¥" "ğ˜™" "ğ™" "ğš")
   ?S ("S" "S" "ğ”–" "ğ•¾" "ğ•Š" "ğ’" "ğ‘†" "ğ‘º" "ğ’®" "ğ“¢" "ğ–²" "ğ—¦" "ğ˜š" "ğ™" "ğš‚")
   ?T ("T" "ê±" "ğ”—" "ğ•¿" "ğ•‹" "ğ“" "ğ‘‡" "ğ‘»" "ğ’¯" "ğ“£" "ğ–³" "ğ—§" "ğ˜›" "ğ™" "ğšƒ")
   ?U ("U" "âˆ©" "ğ”˜" "ğ–€" "ğ•Œ" "ğ”" "ğ‘ˆ" "ğ‘¼" "ğ’°" "ğ“¤" "ğ–´" "ğ—¨" "ğ˜œ" "ğ™" "ğš„")
   ?V ("V" "É…" "ğ”™" "ğ–" "ğ•" "ğ•" "ğ‘‰" "ğ‘½" "ğ’±" "ğ“¥" "ğ–µ" "ğ—©" "ğ˜" "ğ™‘" "ğš…")
   ?W ("W" "Ê" "ğ”š" "ğ–‚" "ğ•" "ğ–" "ğ‘Š" "ğ‘¾" "ğ’²" "ğ“¦" "ğ–¶" "ğ—ª" "ğ˜" "ğ™’" "ğš†")
   ?X ("X" "X" "ğ”›" "ğ–ƒ" "ğ•" "ğ—" "ğ‘‹" "ğ‘¿" "ğ’³" "ğ“§" "ğ–·" "ğ—«" "ğ˜Ÿ" "ğ™“" "ğš‡")
   ?Y ("Y" "â…„" "ğ”œ" "ğ–„" "ğ•" "ğ˜" "ğ‘Œ" "ğ’€" "ğ’´" "ğ“¨" "ğ–¸" "ğ—¬" "ğ˜ " "ğ™”" "ğšˆ")
   ?Z ("Z" "Z" "â„¨" "ğ–…" "â„¤" "ğ™" "ğ‘" "ğ’" "ğ’µ" "ğ“©" "ğ–¹" "ğ—­" "ğ˜¡" "ğ™•" "ğš‰")
   ?a ("a" "É" "ğ”" "ğ–†" "ğ•’" "ğš" "ğ‘" "ğ’‚" "ğ’¶" "ğ“ª" "ğ–º" "ğ—®" "ğ˜¢" "ğ™–" "ğšŠ")
   ?b ("b" "q" "ğ”Ÿ" "ğ–‡" "ğ•“" "ğ›" "ğ‘" "ğ’ƒ" "ğ’·" "ğ“«" "ğ–»" "ğ—¯" "ğ˜£" "ğ™—" "ğš‹")
   ?c ("c" "É”" "ğ” " "ğ–ˆ" "ğ•”" "ğœ" "ğ‘" "ğ’„" "ğ’¸" "ğ“¬" "ğ–¼" "ğ—°" "ğ˜¤" "ğ™˜" "ğšŒ")
   ?d ("d" "p" "ğ”¡" "ğ–‰" "ğ••" "ğ" "ğ‘‘" "ğ’…" "ğ’¹" "ğ“­" "ğ–½" "ğ—±" "ğ˜¥" "ğ™™" "ğš")
   ?e ("e" "Ç" "ğ”¢" "ğ–Š" "ğ•–" "ğ" "ğ‘’" "ğ’†" "â„¯" "ğ“®" "ğ–¾" "ğ—²" "ğ˜¦" "ğ™š" "ğš")
   ?f ("f" "ÉŸ" "ğ”£" "ğ–‹" "ğ•—" "ğŸ" "ğ‘“" "ğ’‡" "ğ’»" "ğ“¯" "ğ–¿" "ğ—³" "ğ˜§" "ğ™›" "ğš")
   ?g ("g" "áµ·" "ğ”¤" "ğ–Œ" "ğ•˜" "ğ " "ğ‘”" "ğ’ˆ" "â„Š" "ğ“°" "ğ—€" "ğ—´" "ğ˜¨" "ğ™œ" "ğš")
   ?h ("h" "É¥" "ğ”¥" "ğ–" "ğ•™" "ğ¡" "â„" "ğ’‰" "ğ’½" "ğ“±" "ğ—" "ğ—µ" "ğ˜©" "ğ™" "ğš‘")
   ?i ("i" "á´‰" "ğ”¦" "ğ–" "ğ•š" "ğ¢" "ğ‘–" "ğ’Š" "ğ’¾" "ğ“²" "ğ—‚" "ğ—¶" "ğ˜ª" "ğ™" "ğš’")
   ?j ("j" "f" "ğ”§" "ğ–" "ğ•›" "ğ£" "ğ‘—" "ğ’‹" "ğ’¿" "ğ“³" "ğ—ƒ" "ğ—·" "ğ˜«" "ğ™Ÿ" "ğš“")
   ?k ("k" "Ê" "ğ”¨" "ğ–" "ğ•œ" "ğ¤" "ğ‘˜" "ğ’Œ" "ğ“€" "ğ“´" "ğ—„" "ğ—¸" "ğ˜¬" "ğ™ " "ğš”")
   ?l ("l" "ê" "ğ”©" "ğ–‘" "ğ•" "ğ¥" "ğ‘™" "ğ’" "ğ“" "ğ“µ" "ğ—…" "ğ—¹" "ğ˜­" "ğ™¡" "ğš•")
   ?m ("m" "É¯" "ğ”ª" "ğ–’" "ğ•" "ğ¦" "ğ‘š" "ğ’" "ğ“‚" "ğ“¶" "ğ—†" "ğ—º" "ğ˜®" "ğ™¢" "ğš–")
   ?n ("n" "u" "ğ”«" "ğ–“" "ğ•Ÿ" "ğ§" "ğ‘›" "ğ’" "ğ“ƒ" "ğ“·" "ğ—‡" "ğ—»" "ğ˜¯" "ğ™£" "ğš—")
   ?o ("o" "o" "ğ”¬" "ğ–”" "ğ• " "ğ¨" "ğ‘œ" "ğ’" "â„´" "ğ“¸" "ğ—ˆ" "ğ—¼" "ğ˜°" "ğ™¤" "ğš˜")
   ?p ("p" "d" "ğ”­" "ğ–•" "ğ•¡" "ğ©" "ğ‘" "ğ’‘" "ğ“…" "ğ“¹" "ğ—‰" "ğ—½" "ğ˜±" "ğ™¥" "ğš™")
   ?q ("q" "b" "ğ”®" "ğ––" "ğ•¢" "ğª" "ğ‘" "ğ’’" "ğ“†" "ğ“º" "ğ—Š" "ğ—¾" "ğ˜²" "ğ™¦" "ğšš")
   ?r ("r" "É¹" "ğ”¯" "ğ–—" "ğ•£" "ğ«" "ğ‘Ÿ" "ğ’“" "ğ“‡" "ğ“»" "ğ—‹" "ğ—¿" "ğ˜³" "ğ™§" "ğš›")
   ?s ("s" "s" "ğ”°" "ğ–˜" "ğ•¤" "ğ¬" "ğ‘ " "ğ’”" "ğ“ˆ" "ğ“¼" "ğ—Œ" "ğ˜€" "ğ˜´" "ğ™¨" "ğšœ")
   ?t ("t" "Ê‡" "ğ”±" "ğ–™" "ğ•¥" "ğ­" "ğ‘¡" "ğ’•" "ğ“‰" "ğ“½" "ğ—" "ğ˜" "ğ˜µ" "ğ™©" "ğš")
   ?u ("u" "n" "ğ”²" "ğ–š" "ğ•¦" "ğ®" "ğ‘¢" "ğ’–" "ğ“Š" "ğ“¾" "ğ—" "ğ˜‚" "ğ˜¶" "ğ™ª" "ğš")
   ?v ("v" "ÊŒ" "ğ”³" "ğ–›" "ğ•§" "ğ¯" "ğ‘£" "ğ’—" "ğ“‹" "ğ“¿" "ğ—" "ğ˜ƒ" "ğ˜·" "ğ™«" "ğšŸ")
   ?w ("w" "Ê" "ğ”´" "ğ–œ" "ğ•¨" "ğ°" "ğ‘¤" "ğ’˜" "ğ“Œ" "ğ”€" "ğ—" "ğ˜„" "ğ˜¸" "ğ™¬" "ğš ")
   ?x ("x" "x" "ğ”µ" "ğ–" "ğ•©" "ğ±" "ğ‘¥" "ğ’™" "ğ“" "ğ”" "ğ—‘" "ğ˜…" "ğ˜¹" "ğ™­" "ğš¡")
   ?y ("y" "Ê" "ğ”¶" "ğ–" "ğ•ª" "ğ²" "ğ‘¦" "ğ’š" "ğ“" "ğ”‚" "ğ—’" "ğ˜†" "ğ˜º" "ğ™®" "ğš¢")
   ?z ("z" "z" "ğ”·" "ğ–Ÿ" "ğ•«" "ğ³" "ğ‘§" "ğ’›" "ğ“" "ğ”ƒ" "ğ—“" "ğ˜‡" "ğ˜»" "ğ™¯" "ğš£")
   ?0 ("0" "0" "0" "0" "ğŸ˜" "ğŸ" "0" "0" "0" "0" "0" "ğŸ¢" "ğŸ¬" "0" "ğŸ¶")
   ?1 ("1" "1" "1" "1" "ğŸ™" "ğŸ" "1" "1" "1" "1" "1" "ğŸ£" "ğŸ­" "1" "ğŸ·")
   ?2 ("2" "2" "2" "2" "ğŸš" "ğŸ" "2" "2" "2" "2" "2" "ğŸ¤" "ğŸ®" "2" "ğŸ¸")
   ?3 ("3" "3" "3" "3" "ğŸ›" "ğŸ‘" "3" "3" "3" "3" "3" "ğŸ¥" "ğŸ¯" "3" "ğŸ¹")
   ?4 ("4" "4" "4" "4" "ğŸœ" "ğŸ’" "4" "4" "4" "4" "4" "ğŸ¦" "ğŸ°" "4" "ğŸº")
   ?5 ("5" "5" "5" "5" "ğŸ" "ğŸ“" "5" "5" "5" "5" "5" "ğŸ§" "ğŸ±" "5" "ğŸ»")
   ?6 ("6" "6" "6" "6" "ğŸ" "ğŸ”" "6" "6" "6" "6" "6" "ğŸ¨" "ğŸ²" "6" "ğŸ¼")
   ?7 ("7" "7" "7" "7" "ğŸŸ" "ğŸ•" "7" "7" "7" "7" "7" "ğŸ©" "ğŸ³" "7" "ğŸ½")
   ?8 ("8" "8" "8" "8" "ğŸ " "ğŸ–" "8" "8" "8" "8" "8" "ğŸª" "ğŸ´" "8" "ğŸ¾")
   ?9 ("9" "9" "9" "9" "ğŸ¡" "ğŸ—" "9" "9" "9" "9" "9" "ğŸ«" "ğŸµ" "9" "ğŸ¿")
   ))
